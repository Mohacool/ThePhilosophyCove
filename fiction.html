<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Short Stories | The Philosophy Cove</title>

    <!-- Import our css file -->
    <link href="subPages_style.css" rel="stylesheet">

    <!-- Import Bootstrap,Jquery... -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>

    <script
    src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
    crossorigin="anonymous"></script>
    <script type="text/javascript">

        
        var global_max = 3; // # of posts on the page
        var all_post_names; //
        var all_post_dates = [];
        var collapsed = false;
        var first_time = true;

        // Get full month name. Ex: 'aug' -> 'August'
        function fullMonthName(short_month){
            
            var months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
            for (x=0;i<months.length;x++){
                if (short_month.toLowerCase()==months[x].slice(0,3).toLowerCase()){
                    return months[x];
                }
            }
        }

        function collapse(){
            if (collapsed==true){
                document.getElementById("posts").style.display = "block";
                document.getElementById("collapsed_cards").style.display = "none";
                collapsed=false;
            }
            else if (collapsed==false){

                //console.log(all_post_names);
                var months_added = [];
                var years_added = [];
                // Clear all the posts
                document.getElementById("posts").style.display = "none";

                // Show the collapsed cards
                document.getElementById("collapsed_cards").style.display = "block";


                //document.getElementById("posts").outerHTML = "";

                //console.log(all_post_dates);

                // Sort 
                all_post_dates.sort((a, b) => new Date(a) - new Date(b))

                if (first_time==true){
                    for (i=0;i<all_post_dates.length;i++){
                    let month = all_post_dates[i].split(" ")[0];
                    let day = all_post_dates[i].split(" ")[1];
                    let year = all_post_dates[i].split(" ")[2];

                    month=fullMonthName(month);

                    // If the month isn't added add it
                    if (!(months_added.includes(month))){
                        months_added.push(month);

                        document.getElementById("collapsed_cards").innerHTML+=`

                            <div class="row">
                                <h1 class="mx-auto">${month}</h1>
                            </div>

                        `;

                    }
                    document.getElementById("collapsed_cards").innerHTML+=`
                        <div id="collapsed_story${i}"class="row pb-1">

                            <div class="col-md-2 red"></div>
                            <div class="col-md-8 red middle">

                                <div class="card mycards pt-2 pb-2">
                                    <span>

                                        <p class="my-auto float-left">${all_post_names[i]}</p>
                                        <p class="my-auto float-right">${all_post_dates[i]}</p>

                                    </span> 
                                </div>

                            </div>
                            <div class="col-md-2 red" ></div>


                        </div>


                        `;

                    //console.log(all_post_dates[i]);
                }
                }
                

                collapsed=true;

            }
            first_time=false;
            
            //console.log(months_added);
            
            
            //console.log("I need it here"+ all_post_dates);
            
            
            
            
            
        }

        function getDates(){
            // Get all the post dates, push into all_post_dates
            for (i=0;i<all_post_names.length;i++){

                $.get(`./Posts/Fiction/${all_post_names[i]}.txt`,{},function(content){

                    // Convert the dates into Date type
                    var date = new Date(content.split('\n')[2]);
                    
                    
                    // Extract [Month,Day,Year] and push to all_post_dates
                    all_post_dates.push(date.toString().split(" ").slice(1,4).join(" "));

                });
            }

        }
       
        
        

        function plus(){

            // Remove the + sign
            document.getElementById("plusrow").outerHTML = "";

            // Add the post break -------

            /*
            document.body.innerHTML += `
                <div class="row mt-3">
                    <p class="mx-auto">_______________</p>
                </div>
            
            `;
            */
            
            
            // Load 3 more posts
            load_posts(all_post_names,global_max,3);



            // Increase total # of posts
            global_max +=3;

        }
        

        // Load posts from post_number to post_number + amount
        function load_posts(post_names, post_number,amount=3){

            all_post_names=post_names.valueOf(); // Store global variable with all the post_names

            console.log("Post names at this point is:"+ post_names);

            let last_post_index = post_number+ amount -1 ;

            for (i=post_number;i<post_number+amount;i++){

                console.log("loading i="+i);
                let post_name = post_names[i];
                let post_number = post_names[i].split('_')[0];
                let post_location = `./Posts/Fiction/${post_name}.txt`;

                // If its not an empty line
                if (post_name.length!=0){

                    console.log(post_name);
                    console.log(post_number);

                    // Create the post container element
                    $('#posts').append(`

                        <div class="container pt-4 do">
                            <div class="row">

                                <div class="col-md-2"></div>
                                <div class="col-md-8 do">
                                    
                                    <div class="row do">
                                        <h5 id="${"title"+post_number}" class="mx-auto  post_title" ></p>
                                    </div>

                                    <div class="row mydate do">
                                        <p id="${"date"+post_number}" class="mx-auto" style="font-style:italic; font-size:14px;"></p>
                                    </div>

                                    <p id="${"story"+post_number}"></p>

                                </div>
                            </div>
                        </div>

                    `);
                    
                   
                    // Don't include the line break on the last post
                    if (i!=last_post_index){
                        $('#posts').append(`
                            <div class="row mt-3">
                                <p class="mx-auto">_______________</p>
                            </div>
                        `
                        );
                    }
                    
                    
                    // Get the post .txt and add it to container element 
                    $.get(post_location,{},function(content){

                        let lines=content.split('\n');

                        // Get title,date and body 
                        let title = lines[0];
                        let date = lines[2];
                        let body = lines.slice(4,);

                        // New body after adding line breaks
                        let blody = body.map( element => element.replace('','<br>'));

                        //console.log(`Title : ${title}`);
                        //console.log(`Date : ${date}`);
                        //console.log(`Body : ${blody}`);

                        // append to divs
                        $(`#title${post_number}`).text(title);
                        $(`#date${post_number}`).text(date);
                        $(`#story${post_number}`).html(blody);

                    });
                    
                }
            }

            // Add a + sign after the last post
            $('#posts').append(`
                <div id="plusrow" class="row pt-4 pb-4">


                    <img id="plus" class="mx-auto" src="plus.svg" onclick="plus()">
                    

                </div>
            `);


        }


        $(document).ready(function () {

            //collapse();
            

            // Get all the file names in include 
            $.get('./Posts/Fiction/include',{},function(content){

                // Ex:  ["1_blah_blah","2_blee_blee"]
                var post_names=content.split('\n');
                console.log(post_names);

                


                load_posts(post_names,0,3); // Load the top 3 (amount=3 default)

                
                getDates();

                //console.log(all_post_dates);
                
            

                

                //load_posts(post_names,3); // Load the next 3 

                
            
            });    

        });
        
        
    </script>

</head>


<body>
    <nav class="navbar sticky-top navbar-light desktop">
        <a class="navbar-brand pt-3 pl-2" href="index.html">
          <img class="mylogo" height ="60" width = "60" src="logoNoText.png"  alt="">
        </a>
        <h5 class="subtitle navbar-text mr-auto">Works of Fiction</h5>


        <img class="navbar-brand filter" src="filter.svg "height="40px" onclick="collapse()">

    </nav>
    

    
    <div id="posts">

    </div>

   
    <!--
    <div class="pos-f-t">
        <div class="collapse" id="navbarToggleExternalContent">
          <div class="bg-dark p-4">
            <h4 class="text-white">By Date</h4>
            
            <span class="text-muted">Toggleable via the navbar brand.</span>
          </div>
        </div>
        <nav class="navbar navbar-dark bg-dark">
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggleExternalContent" aria-controls="navbarToggleExternalContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        </nav>
    </div>
    -->

    
    

    

    <!-- BLOG POST SAMPLE 
    <div class="container  pt-4 do">
        <div class="row">
            <div class="col-md-2"></div>

            <div class="col-md-8 do">
                
                <div class="row do">
                    <h5 class="mx-auto post_title" >A Walk in The Park </p>
                </div>

                <div class="row mydate do">
                    <p class="mx-auto" style="font-style:italic; font-size:14px;">07/23/2020</p> 
                </div>

                    <p>
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed ultricies sapien non efficitur dapibus. Aenean convallis iaculis felis, at bibendum ex gravida vel. Phasellus nec arcu sed neque dapibus scelerisque vel in ante. Aenean imperdiet velit non mauris dignissim, eu condimentum massa aliquet. Aenean vel ultrices lectus. In feugiat tellus faucibus felis pellentesque, id bibendum nunc convallis. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Donec posuere neque purus. In non enim odio. Quisque enim justo, efficitur non vulputate a, fringilla ut urna.
            
                        Donec in sem luctus mauris fermentum venenatis vitae ut neque. Mauris a hendrerit nunc. Donec pellentesque purus in ante suscipit imperdiet. Praesent lacinia, urna vitae congue varius, est leo commodo mauris, vel mollis mauris ligula a risus. Praesent nec enim quam. Ut ornare porttitor sodales. Praesent nisl urna, eleifend vel lectus sed, pharetra pretium leo. Maecenas facilisis neque at orci pulvinar vestibulum. Interdum et malesuada fames ac ante ipsum primis in faucibus. Nulla facilisi. Nulla aliquam, augue id ultrices imperdiet, enim ipsum vehicula risus, id fermentum turpis quam id lorem. Morbi vitae pretium lectus.
                        
                        Nullam tristique neque at viverra hendrerit. <br><br> Integer ut egestas erat. Maecenas quis ipsum ut est viverra imperdiet at vitae ante. Maecenas ac ullamcorper dui. Nunc eu pellentesque orci, id sagittis ex. Etiam eget quam ut enim hendrerit efficitur. Sed vehicula ex non tristique vehicula. Cras felis orci, pellentesque sit amet volutpat sed, gravida nec felis. Suspendisse tincidunt malesuada ornare. In tincidunt tellus risus, ac blandit nibh iaculis vitae. Integer ullamcorper augue id odio pulvinar ultrices. Curabitur et egestas dui. Ut erat risus, venenatis eget commodo a, scelerisque in tellus. Vivamus dapibus luctus maximus. In eget odio ante.
                        
                        Cras tempus, metus vel viverra feugiat, est leo ornare leo, quis dignissim nisl odio porta enim. Pellentesque sit amet dui quis libero pellentesque maximus faucibus vel dolor. Nullam sit amet ullamcorper ante. Sed condimentum ante ac faucibus pulvinar. Nullam arcu velit, faucibus sed mauris elementum, blandit semper justo. Nunc erat est, placerat at facilisis sed, condimentum nec quam. Sed a condimentum nibh. Sed vulputate tincidunt metus sit amet condimentum. Vivamus finibus viverra lacus. Nam vel nisl sollicitudin, tincidunt purus a, tincidunt nisi. Nullam id eros imperdiet, rhoncus sapien nec, pulvinar urna. Donec mattis purus eget urna vestibulum porttitor.
                        
                        Nulla euismod scelerisque faucibus. <br><br> Praesent ut ante dolor. Pellentesque porttitor, arcu ac euismod lobortis, velit tortor imperdiet ante, sit amet tempus sapien nulla sed lectus. Phasellus eu finibus elit. Vestibulum aliquet tincidunt efficitur. Proin at gravida est, sed malesuada enim. Ut in egestas nisi. Quisque aliquet ac nibh vel suscipit.
                    </p>

            </div>
            
        </div>
        
    </div>
    -->
    
    <div id="collapsed_cards" class="container">
        <div class="row" style="margin-top:50px">
        </div>

        
        
        

        
        
        
        
        
    </div>


</body>

</html>